{"version":3,"file":"static/webpack/static/development/pages/write-chinese.js.7fb4ca64436632b4b18e.hot-update.js","sources":["webpack:///./pages/write-chinese.tsx"],"sourcesContent":["import React, {\n  useState,\n  useCallback,\n  useEffect,\n  useLayoutEffect\n} from \"react\";\nimport { Pane } from \"evergreen-ui\";\nimport WriteCharactorSearch from \"@components/WriteCharactor/WriteCharactorSearch\";\nimport chinese from \"@constants/chinese.json\";\nimport { converttoNoTone } from \"@utils/utils\";\nlet time = 0;\nlet reqFrame;\nlet paths = [];\nconst BOARD_CELL_SIZE = 298;\nconst BOARD_SIZE = 3;\nconst PADDING = 2;\nconst LAYOUT_SIZE = 600;\nconst commonWords = `的一是在不了有和人这中大为上个国我以要他时来用们生到作地于出就分对成会可主发年动同工也能下过子说产种面而方后多定行学法所民得经十三之进着等部度家电力里如水化高自二理起小物现实加量都两体制机当使点从业本去把性好应开它合还因由其些然前外天政四日那社义事平形相全表间样与关各重新线内数正心反你明看原又么利比或但质气第向道命此变条只没结解问意建月公无系军很情者最立代想已通并提直题党程展五果料象员革位入常文总次品式活设及管特件长求老头基资边流路级少图山统接知较将组见计别她手角期根论运农指几九区强放决西被干做必战先回则任取据处队南给色光门即保治北造百规热领七海口东导器压志世金增争济阶油思术极交受联什认六共权收证改清己美再采转更单风切打白教速花带安场身车例真务具万每目至达走积示议声报斗完类八离华名确才科张信马节话米整空元况今集温传土许步群广石记需段研界拉林律叫且究观越织装影算低持音众书布复容儿须际商非验连断深难近矿千周委素技备半办青省列习响约支般史感劳便团往酸历市克何除消构府称太准精值号率族维划选标写存候毛亲快效斯院查江型眼王按格养易置派层片始却专状育厂京识适属圆包火住调满县局照参红细引听该铁价严龙飞`;\n\nconst VoiceComponent = props => (\n  <svg\n    className=\"icon\"\n    viewBox=\"0 0 1024 1024\"\n    width={18}\n    height={18}\n    {...props}\n  >\n    <defs>\n      <style />\n    </defs>\n    <path\n      d=\"M787.91 882.152c-3.236 1.673-7.311 2.393-12.216 2.393-10.657 0-19.64-5.752-24.549-15.572-3.226-6.588-4.065-13.889-1.673-20.473 2.393-6.595 7.308-12.216 13.89-15.575C889.101 770.772 966.7 649.103 966.7 516.663c0-138.91-87.299-266.452-222.023-325.243-6.585-3.233-11.374-8.148-14.725-14.729-2.393-6.59-2.393-13.889 0-21.197 4.068-9.82 13.888-16.285 25.265-16.285 4.069 0 7.308.84 10.656 2.4 155.082 67.058 254.714 214.115 254.714 375.064 0 153.876-88.976 293.628-232.677 365.48zm47.418-354.587c0 125.023-94.723 224.655-212.32 224.655-14.725 0-26.944-12.213-26.944-26.948 0-14.729 12.212-26.948 26.944-26.948 87.3 0 158.434-76.756 158.434-171.602 0-94.84-71.015-171.599-158.434-171.599-14.725 0-26.944-12.213-26.944-26.948s12.212-26.948 26.944-26.948c117.6-.106 212.32 101.321 212.32 226.338zm-314.348 415.9c-13.052 0-26.098-6.59-37.6-17.964L231.184 672.106H73.591c-38.324 0-70.178-31.853-70.178-70.298V422.902c0-39.28 31.857-71.134 70.178-71.134h156.754L482.546 98.492c11.377-11.49 24.549-17.961 37.602-17.961 23.709 0 39.997 20.476 39.997 49.817v763.177c.836 29.46-15.452 49.94-39.165 49.94zm-14.725-790.24L253.218 406.617H73.591a16.302 16.302 0 00-16.285 16.285v178.19a16.302 16.302 0 0016.285 16.284h179.627L506.255 870.65V153.225z\"\n      fill=\"#1296db\"\n    />\n  </svg>\n);\n\nexport default function() {\n  const [char, setChar] = useState(\"\");\n  const [pinyin, setPinyin] = useState(\"\");\n  const onSearch = slug => {\n    if (char && slug == char) {\n      location.reload();\n    }\n    cancelAnimationFrame(reqFrame);\n    paths = [];\n    if(/[\\x00-\\x99]/.test(slug)) {\n      slug = slug.slice(0, 1);\n    }\n    if (slug && chinese[slug]) {\n      paths = JSON.parse(JSON.stringify(chinese[slug]));\n      location.hash = \"#/\" + slug;\n    } else {\n      paths = [];\n      if (window.history.pushState) {\n        window.history.pushState(\"\", \"/\", window.location.pathname);\n      } else {\n        window.location.hash = \"\";\n      }\n    }\n    toTop();\n    setTimeout(()=> {\n      setChar(slug);\n    }, 300)\n  };\n\n  const toTop = ()=> {\n    try {\n      // trying to use new API - https://developer.mozilla.org/en-US/docs/Web/API/Window/scrollTo\n      window.scroll({\n        top: 0,\n        left: 0,\n        behavior: 'smooth',\n      });\n    } catch (error) {\n      // just a fallback for older browsers\n      window.scrollTo(0, 0);\n    }\n  }\n  const draw = startTime => {\n    if (!__CLIENT__) {\n      return;\n    }\n    var canvas = document.getElementById(\"canvas\") as HTMLCanvasElement;\n    var ctx = canvas.getContext(\"2d\");\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    ctx.lineWidth = 4;\n    //画田字格\n    var drawBoard = function() {\n      ctx.setLineDash([]);\n      ctx.strokeStyle = \"red\"; // red\n      for (var i = 0; i < BOARD_SIZE; i++) {\n        ctx.beginPath();\n        ctx.moveTo(PADDING + i * BOARD_CELL_SIZE, PADDING);\n        ctx.lineTo(\n          PADDING + i * BOARD_CELL_SIZE,\n          BOARD_CELL_SIZE * BOARD_SIZE - PADDING\n        );\n        ctx.stroke();\n        ctx.moveTo(PADDING, PADDING + i * BOARD_CELL_SIZE);\n        ctx.lineTo(\n          BOARD_CELL_SIZE * BOARD_SIZE - PADDING,\n          PADDING + i * BOARD_CELL_SIZE\n        );\n        ctx.stroke();\n      }\n\n      // X\n      ctx.beginPath();\n      ctx.setLineDash([5, 15]);\n      ctx.moveTo(0, 0);\n      ctx.lineTo(600, 600);\n      ctx.stroke();\n      // X\n      ctx.beginPath();\n      ctx.setLineDash([5, 15]);\n      ctx.moveTo(600, 0);\n      ctx.lineTo(0, 600);\n      ctx.stroke();\n\n      ctx.closePath();\n    };\n    drawBoard();\n    const drawWord = thepaths => {\n      if (startTime !== time) {\n        return;\n      }\n      var vertices = [];\n      if (thepaths.length > 0) {\n        vertices = thepaths.shift();\n      } else {\n        return;\n      }\n      // calculate incremental points along the path\n      var points = calcWaypoints(vertices);\n      // extend the line from start to finish with animation\n      // calc waypoints traveling along vertices\n      function calcWaypoints(vertices) {\n        var waypoints = [];\n        var fps = 50;\n        var len = vertices.length;\n        if (len > 3) {\n          fps = 40;\n        }\n        for (var i = 1; i < len; i++) {\n          var pt0 = vertices[i - 1];\n          var pt1 = vertices[i];\n          var dx = pt1[0] - pt0[0];\n          var dy = pt1[1] - pt0[1];\n          for (var j = 0; j < fps; j++) {\n            var x = pt0[0] + (dx * j) / fps;\n            var y = pt0[1] + (dy * j) / fps;\n            waypoints.push({\n              x: x,\n              y: y\n            });\n          }\n        }\n        return waypoints;\n      }\n      var t = 1;\n      function animate() {\n        if (startTime !== time) {\n          cancelAnimationFrame(reqFrame);\n          return;\n        }\n        ctx.lineCap = \"round\";\n        ctx.lineWidth = 15;\n        ctx.strokeStyle = \"#000\";\n        ctx.beginPath();\n        ctx.moveTo(points[t - 1].x, points[t - 1].y);\n        ctx.lineTo(points[t].x, points[t].y);\n        ctx.stroke();\n\n        if (t < points.length - 1) {\n          reqFrame = requestAnimationFrame(animate);\n        } else {\n          drawWord(thepaths);\n        }\n        t++;\n      }\n      animate();\n    };\n    if (char && paths && paths.length) {\n      drawWord(paths);\n    }\n  };\n  let audioRef = React.createRef() as any;\n  useEffect(() => {\n    time = new Date().getTime();\n    draw(time);\n\n    try {\n      if (!char) return;\n      let py = transPinyin(char);\n      setPinyin(py);\n      let tone = converttoNoTone(py).trim();\n      let t = `https://raw.githubusercontent.com/icai/tts-chinese/master/dist/${tone}.mp3`;\n      var n = audioRef;\n      n.setAttribute(\"datasrc\", t);\n    } catch (e) {}\n  }, [char]);\n\n  useEffect(() => {\n    let path = decodeURIComponent(location.hash.slice(2));\n    onSearch(path);\n  }, []);\n\n  const onVoiceHover = () => {\n    var n = audioRef;\n    n.src = n.getAttribute(\"datasrc\");\n  };\n\n  const onVoiceClick = () => {\n    var n = audioRef;\n    n.loop = false;\n    n.play();\n  };\n\n  return (\n    <Pane width=\"800px\" height=\"100%\" margin=\"auto\">\n      <WriteCharactorSearch\n        char={char}\n        onSearch={onSearch}\n      ></WriteCharactorSearch>\n      <Pane\n        className=\"clearfix\"\n        width={\"600px\"}\n        margin={\"auto\"}\n        paddingTop={50}\n      >\n        <canvas id=\"canvas\" width={LAYOUT_SIZE} height={LAYOUT_SIZE}></canvas>\n      </Pane>\n      <Pane lineHeight=\"32px\" fontSize=\"18px\">\n        拼 音: {pinyin}{\" \"}\n        <VoiceComponent\n          style={{ verticalAlign: \"middle\", cursor: \"pointer\" }}\n          onMouseEnter={onVoiceHover}\n          onClick={onVoiceClick}\n        ></VoiceComponent>\n      </Pane>\n      <div className=\"text-right\">\n        <a\n          href=\"https://github.com/w3cub/w3cubtools-md/issues\"\n          target=\"_blank\"\n          className=\"word\"\n        >\n          Report an error\n        </a>\n      </div>\n      <h3>常用字</h3>\n      <Pane>\n        {commonWords.split(\"\").map(word => {\n          return (\n            <a\n              href=\"javascript:;\"\n              className=\"word\"\n              key={word}\n              onClick={() => {\n                onSearch(word);\n              }}\n            >\n              {word}\n            </a>\n          );\n        })}\n      </Pane>\n      <div style={{ display: \"none\" }}>\n        <audio\n          id=\"audio\"\n          ref={input => {\n            audioRef = input;\n          }}\n        ></audio>\n      </div>\n\n      <style jsx>{`\n        .word {\n          margin-right: 20px;\n          line-height: 25px;\n          color: #000;\n        }\n      `}</style>\n    </Pane>\n  );\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAXA;AACA;AAiBA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA,iBAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAIA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AACA;AACA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AANA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAhDA;AAAA;AAAA;AAiEA;;;;A","sourceRoot":""}